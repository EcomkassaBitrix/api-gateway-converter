# ‚úÖ Express.js Server Setup ‚Äî –ì–æ—Ç–æ–≤–æ!

## üéâ –ß—Ç–æ —Å–æ–∑–¥–∞–Ω–æ

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π **Express.js backend** –¥–ª—è API Gateway –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä `gw.ecomkassa.ru`

---

## üì¶ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend —Å–µ—Ä–≤–µ—Ä

```
server/
‚îú‚îÄ‚îÄ ‚úÖ index.js              # Express.js —Å–µ—Ä–≤–µ—Ä —Å 3 API endpoints
‚îú‚îÄ‚îÄ ‚úÖ package.json          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (express, axios, pg, cors)
‚îú‚îÄ‚îÄ ‚úÖ .env.example          # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ ‚úÖ .gitignore           # –ò–≥–Ω–æ—Ä node_modules –∏ .env
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

```
server/
‚îú‚îÄ‚îÄ ‚úÖ README.md            # API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
‚îú‚îÄ‚îÄ ‚úÖ DEPLOY.md            # –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–µ–ø–ª–æ—è (20+ —à–∞–≥–æ–≤)
‚îú‚îÄ‚îÄ ‚úÖ QUICK-START.md       # –î–µ–ø–ª–æ–π –∑–∞ 10 –º–∏–Ω—É—Ç (copy-paste)
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```
server/
‚îú‚îÄ‚îÄ ‚úÖ nginx-config-example.conf  # –ì–æ—Ç–æ–≤—ã–π nginx –∫–æ–Ω—Ñ–∏–≥
‚îú‚îÄ‚îÄ ‚úÖ test-api.sh                # Bash —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```

### –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞)

```
./
‚îú‚îÄ‚îÄ ‚úÖ DEPLOYMENT-GUIDE.md    # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–µ–ø–ª–æ—è (5 –º–∏–Ω—É—Ç)
‚îú‚îÄ‚îÄ ‚úÖ PROJECT-INFO.md        # –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ ‚úÖ ARCHITECTURE.md        # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ö–µ–º—ã
‚îú‚îÄ‚îÄ ‚úÖ DOCS-INDEX.md          # –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ ‚úÖ SERVER-SETUP-COMPLETE.md  # –≠—Ç–æ—Ç —Ñ–∞–π–ª (summary)
```

---

## üöÄ API Endpoints

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã:

### 1. ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
**POST** `https://gw.ecomkassa.ru/api/Authorization/CreateAuthToken`

### 2. ‚úÖ –°—Ç–∞—Ç—É—Å —á–µ–∫–∞
**GET** `https://gw.ecomkassa.ru/api/kkt/cloud/status`

### 3. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —á–µ–∫–∞
**POST** `https://gw.ecomkassa.ru/api/kkt/cloud/receipt`

### 4. ‚úÖ Health Check
**GET** `https://gw.ecomkassa.ru/health`

---

## üéØ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

–í—Å—è –ª–æ–≥–∏–∫–∞ –∏–∑ Python Cloud Functions –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ Node.js:

### ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (ekomkassa-auth)
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `{login, password}`
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ `{login, pass}`
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ eKomKassa API
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω

### ‚úÖ –°—Ç–∞—Ç—É—Å —á–µ–∫–∞ (ekomkassa-status)
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `uuid`, `AuthToken`, `group_code`
- –§–æ—Ä–º–∏—Ä—É–µ—Ç URL: `v5/{group_code}/report/{uuid}`
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `Token`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å

### ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —á–µ–∫–∞ (ekomkassa-receipt)
- **–í–∞—Ä–∏–∞–Ω—Ç 1**: –ü–æ–ª–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Ferma ‚Üí eKomKassa
  - –ú–∞–ø–ø–∏–Ω–≥ VAT —Ç–∏–ø–æ–≤
  - –ú–∞–ø–ø–∏–Ω–≥ —Å–∏—Å—Ç–µ–º –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏—è
  - –ú–∞–ø–ø–∏–Ω–≥ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è
  - –ú–∞–ø–ø–∏–Ω–≥ —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π
- **–í–∞—Ä–∏–∞–Ω—Ç 2**: –ü—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ eKomKassa —Ñ–æ—Ä–º–∞—Ç–µ

### ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ PostgreSQL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- Request ID –¥–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞
- Duration tracking
- Status codes

---

## üìã –ß—Ç–æ –¥–∞–ª—å—à–µ?

### –®–∞–≥ 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
cd server
npm install
npm start
```

–û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:3001/health

### –®–∞–≥ 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

```bash
cd server
chmod +x test-api.sh
./test-api.sh
```

### –®–∞–≥ 3: –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

**–í–∞—Ä–∏–∞–Ω—Ç A: –ë—ã—Å—Ç—Ä–æ (5 –º–∏–Ω—É—Ç)**
–ß–∏—Ç–∞–π—Ç–µ: [DEPLOYMENT-GUIDE.md](./DEPLOYMENT-GUIDE.md)

**–í–∞—Ä–∏–∞–Ω—Ç B: Copy-paste –∫–æ–º–∞–Ω–¥—ã (10 –º–∏–Ω—É—Ç)**
–ß–∏—Ç–∞–π—Ç–µ: [server/QUICK-START.md](./server/QUICK-START.md)

**–í–∞—Ä–∏–∞–Ω—Ç C: –ü–æ–¥—Ä–æ–±–Ω–æ (—Å –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º)**
–ß–∏—Ç–∞–π—Ç–µ: [server/DEPLOY.md](./server/DEPLOY.md)

---

## üîç –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ [DOCS-INDEX.md](./DOCS-INDEX.md) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –Ω—É–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

**–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã:**

- üöÄ [–ö–∞–∫ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å?](./DEPLOYMENT-GUIDE.md)
- üì° [–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API?](./server/README.md)
- üèóÔ∏è [–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?](./ARCHITECTURE.md)
- üêõ [–ß—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å](./server/DEPLOY.md#troubleshooting)

---

## ‚úÖ Checklist –¥–ª—è –¥–µ–ø–ª–æ—è

- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Node.js 18+
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω PM2
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω nginx
- [ ] –î–æ–º–µ–Ω –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [ ] –ü—Ä–æ–µ–∫—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –≤ `/var/www/ekomkassa-gateway`
- [ ] Backend: `npm install` –≤—ã–ø–æ–ª–Ω–µ–Ω
- [ ] Backend: `.env` —Å–æ–∑–¥–∞–Ω
- [ ] Backend: `pm2 start index.js` –∑–∞–ø—É—â–µ–Ω
- [ ] Frontend: `npm run build` –≤—ã–ø–æ–ª–Ω–µ–Ω
- [ ] nginx: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
- [ ] SSL: certbot –≤—ã–ø–æ–ª–Ω–µ–Ω
- [ ] –¢–µ—Å—Ç: `curl https://gw.ecomkassa.ru/health` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –¢–µ—Å—Ç: API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ Postman

---

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend
- **Runtime**: Node.js 18+
- **Framework**: Express.js 4.18
- **HTTP Client**: Axios 1.6
- **Database**: PostgreSQL + pg 8.11 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **Process Manager**: PM2
- **Environment**: dotenv

### Frontend
- **Framework**: React 18
- **Language**: TypeScript
- **Build Tool**: Vite
- **UI**: Tailwind CSS + shadcn/ui
- **Router**: React Router

### Infrastructure
- **Web Server**: nginx
- **SSL**: Let's Encrypt (Certbot)
- **OS**: Ubuntu/Debian

---

## üéâ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é!

–í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã, –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞.

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –û—Ç–∫—Ä–æ–π—Ç–µ [DEPLOYMENT-GUIDE.md](./DEPLOYMENT-GUIDE.md) –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º! üöÄ

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
cd server
npm install
npm start

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health
curl http://localhost:3001/health

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö endpoints
./test-api.sh

# –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
# (—Å–º. DEPLOYMENT-GUIDE.md)

# –õ–æ–≥–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
pm2 logs ekomkassa-gateway
tail -f /var/log/nginx/gw.ecomkassa.ru-error.log

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 restart ekomkassa-gateway
sudo systemctl reload nginx
```

---

**–í–æ–ø—Ä–æ—Å—ã?** –°–º–æ—Ç—Ä–∏—Ç–µ [DOCS-INDEX.md](./DOCS-INDEX.md) –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –≤—Å–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏! üìö
